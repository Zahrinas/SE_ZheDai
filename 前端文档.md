# 微信小程序前端文档



前端的实现细节在代码内用注释描述



文档主要描述与后端的接口

目前来说，前端主要使用`wx.request`与后端通过url进行数据交换，其在前端中用法大致如下：

获取数据：

```js
wx.request({
    url: 'https://我们的后端域名',
    success: function(res) {
      that.setData({
        orderList: res.data
      });
    }
  });
```

发送数据：
```js
wx.request({
      url: '后端的url',
      method: 'POST',
      data: {
        value: this.order
      },
      success: function(res) {
        console.log(res.data);
      }
    });
```


### 以下是对于前端与后端交互的数据描述文档

主要有3个数据库，订单数据库，个人信息数据库，聊天记录数据库

#### 与订单数据库的数据交换

对于我们与后端交换的数据，有：
  1.在接单时，前端向后端发送一个订单的所有信息，称为order，其包括：
```js
order:{
        select: '0',//select为'1'时，为筛选请求;为‘0’时为普通订单
        id: 订单id,//string类
        posterId: 发布者id,//string类
        nickName: 昵称,//string类
        posterHeadImg: 订单上传者的头像的url,//string类
        riderId: 骑手id,(对于发布中未被接单的订单，置为null，在后端向)//string类
        school: 校区,//string类
        type: 任务类型,//string类
        time: 截止时间，//string类
        reward：报酬,//string类
        comment:备注//string类
      }
```

  2.在显示订单时，后端需要向前端发送，由order组成的一个列表orderList
  
  3.在筛选显示时，前端先向后端发送一个请求包，其内select置为1，为非筛选条件的类型置为‘null’，例如针对posterId和school进行筛选：
```js
order:{
        select: '1',//select为'1'时，为筛选请求
        id: ‘null’,//string类，为非筛选条件置为'null'
        posterId: 发布者id,//string类
        nickName: ‘null’,//string类，为非筛选条件置为'null'
        posterHeadImg: 'null',//string类
        riderId: 'null'//string类
        school: 校区,//string类
        type: 'null',//string类
        time: 'null'，//string类
        reward：'null',//string类
        comment:'null'//string类
      }
```
  然后，后端需要向前端发送，由order组成的一个满足条件的列表orderList

  #### 与聊天数据库的数据交换
  ##### 聊天列表，每一个条目对应与一个用户的聊天记录 
```js
  chatList = [
      {
        sendId: 'null', //string类 发送者id
        receiveId: 'null' //string类 接受者id
        id: '1', //string类 聊天列表界面每个条目对应的id
        avatar: 'url', //string类 头像对应
        nickname: 'null', //string类 昵称
        lastMsg: 'null', //string类 上次消息
        time: 'null' //string类 上次时间
      }
      {
        id: '2'
        ...
      }
  ]
```
  ##### 聊天记录
  此处给后端传参发送者ID和接收者ID，后端传回对应的聊天记录
```js
  messageList: [
          {
            id: '1', //string类 每条消息对应id
            sendId: 'null', //string类 发送者id
            receiveId: 'null', //string类 接收者id
            nickname: 'null', //string类 用户昵称
            content: 'null', //string类 消息内容
            time: 'null', //string类 消息时间
            self: false //bool类 为true表示自己发出，反之为对方发出
          }
          {
            id: 2
            ...
          }
  ]
```
  #### 与个人信息数据库的数据交换
1.在显示个人信息时后端应当向前端发送数据：
```js
  info: {
     id: '1', //string类 用户id
     nickname: 'null', //string类 用户昵称
     school: 'null', //string类 校区信息
     vx: 'null', //string类 联系方式
     avatar: 'url' //string类，为用户头像url地址
  }
```

2.在完成编辑个人信息按下确认后，前端会向后端传送数据：
```js
  info: {
     id: '1', //string类 用户id
     nickname: 'null', //string类 用户昵称
     school: 'null', //string类 校区信息
     vx: 'null', //string类 联系方式
     avatarData: //为序列化的用户头像数据,类型目前未知，可能就是二进制串
  }
```
在接收到以上数据后，后端存储这些数据并且把被序列化的图片数据还原，并且给该图片分配一个可以被前端访问到的url地址然后填入以下类中，该类正是1.中前端向后端申请的数据：
```js
  info: {
     id: '1', //string类 用户id
     nickname: 'null', //string类 用户昵称
     school: 'null', //string类 校区信息
     vx: 'null', //string类 联系方式
     avatar: 'url' //string类，为用户头像url地址
  }
```